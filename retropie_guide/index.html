<!DOCTYPE html>
<html lang="ru">

<head> 
<meta charset="utf-8"> 
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta keywords="Ключевые слова для поисковых запросов">
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>RETROPIE MANUAL</title> 
<link href="css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/flipclock.css"> 
<link rel="stylesheet" href="fonts/font-awesome.min.css">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<script type="text/javascript" src="https://vk.com/js/api/openapi.js?154"></script>

</head>

<body>

<section>
	<div class="container">
		<div class="parent row">
			<div class="block col-sm-8">
				
				<h1 class="">Инструкция по настройке RetroPie.</h1>
				<br>
				<h2 class="">Данный мануал актуален для RetroPie версии 4.1 - 4.3</h2>
				<br>
				<h4><strong>Запись/перезапись образа. Восстановление флешки.</strong></h4>
				<br>
				<p>
					Запись - тривиально. Качаем <a target="_blank" href="ads/Win_32_DiskImager.exe">Win32 disk imager</a> и с помощью него извлекаем .img образ на SD карту. Все. В интернете куча инструкций, как им пользоваться.
					<br><br>
					Если вы по каким-то причинам напортачили, и хотите записать образ на флешку заново, или просто вернуть ее в прежнее состояние, то нужно провернуть следующее:
					<br><br>
					Открываем коммандную строку от имени администратора (пуск-поиск-ввести cmd, клик правой кнопкой, выбрать "запустить от имени администратора)
					<br><br>
					Убеждаемся, что флешка установлена в кардридер.
					Далее последовательно вводим комманды, и после каждой жмем Enter.
				</p>
				<blockquote>
					
						diskpart <br>
						list disk <br>
						select disk % 
						<footer>вместо % указывается номер вашей флешки</footer>
						clean <br>
						attributes disk clear readonly <br>
						create partition primary <br>
						format fs=fat32 QUICK <br>
						exit <br>
					
				</blockquote>
				<p>После этой операции, флешка вернется в прежнее состояние.</p>
				<br>
				<h4><strong>
					Первоначальная настройка.
				</strong></h4>
				<br>
				<p>
					Втыкаем SD карту в порт на плате, подключаем геймпад, клавиатуру и  патчкорд в сетевой порт (если не хочется работать через WiFi). Я  настоятельно рекомендую использовать LAN соединение, тк по WiFi все ощутимо медленнее. Подключаем HDMI и питание. <br><br>
					При первом запуске малина перезагружается, после чего откроется окно с  настройками геймпада. Удерживаем кнопку A геймпада, после чего  поочередно назначаем кнопки. <br><br>
					После настройки открывается основное меню. На данный момент будет  доступен только раздел с настройками, туда и заходим. Внутри выбираем  WiFi. Далее подключаемся к нашей точке доступа (компьютер так же  должен быть подключен к ней) и вводим пароль. Все, после подключения  выходим из мастера настройки WiFi, но питание малины не отключаем.  Клаву от малины теперь можно отключить. <br><br>
					Отложим малину в сторону и сядем за пк. Сначала устанавливаем <a target="_blank" href="ads/WinSCP.exe">WinSCP</a> (sftp клиент). После установки открывается окно, в котором вводим  следующее: <br><br>
					<strong>
						Имя хоста: RETROPIE <br>
						Имя пользователя: pi <br>
						Пароль: raspberry <br>
					</strong>
					<br>
					Протокол и порт оставляем как есть. Подключаемся. Во всех окнах жмем  Да/ОК и тд. <br><br>
					<strong><em>
						*В retropie 4.2 и выше SSH сервер по умолчанию отключен. Чтобы подключаться к малине по winscp его надо включить в настройках. <br>
						Как это сделать показано <a target="_blank" href="https://www.youtube.com/watch?v=QG569N-bcdw">в этом видео</a>.
					</em></strong>
				</p>
				<br>
				<h4><strong>
					Первоначальная настройка WinSCP.
				</strong></h4>
				<br>
				<p>
					В первую очередь заходим в корень программы, находим там папку Putty.  В эту папку копируем <a target="_blank" href="ads/putty.exe">putty.exe</a>. Далее в самой проге заходим в  настройки, переходим в раздел интеграция->программы. Указываем  местоположение putty.exe, который только что скопировали в корень. Так  же ставим галку на "помнить пароль". Жмем ок. <br><br>
					Сейчас желательно настроить все так, чтобы в следующие разы  подключаться к малине с root правами. Для этого находим в панели  инструментов значок putty (удаленный терминал). Жмем, и если в прошлый  раз все сделали правильно, то он автоматически залогинится и вы  увидите привественный экран с информацией используемого пространства,  температуры и тд. Теперь можно использовать консольные команды прямо с  вашего пк, не подключая клавиатуру к самой малине. <br><br>
					<strong>
						Далее про root права:
					</strong>
					<br><br>
					Вводим
					<blockquote>
						sudo nano /etc/ssh/sshd_config
					</blockquote> 
					<p>
					и жмем ввод. <br><br>
					В открывшемся файле находим строку <em>PermitRootLogin</em> и добавляем после  нее <em>yes</em>. <br>
					Должно получиться так:</p>
					
					<blockquote>
						PermitRootLogin yes
					</blockquote>
					
					<p>Если в этой строке будет что-то вроде <em>without password</em>, то удаляем,  оставив все так, как в примере выше. Жмем ctrl+x, далее y, далее Enter. <br>
					Следующий шаг - установка пароля для root. Вводим:</p>
					
					<blockquote>
						sudo passwd root
					</blockquote>
					<p>После чего дважды вводим пароль (во время ввода знаки не отображаются). <br> 
					Рекомендую  установить пароль из символов без цифр. Например - root. <br> 
					Далее проверяем, изменился ли пароль. Вводим в консоль:</p>
					
					<blockquote>
						su
					</blockquote>
					<p>затем пароль (при вводе его так же не видно) <br><br>
					Если зашли, то все получилось. Если нет - гуглите. Вряд ли ваша  проблема уникальная. Если вам не нужны root права, то пропустите этот  абзац. <br><br>
					После всего этого вводим:</p>
					
					<blockquote>
						sudo reboot
					</blockquote>
					<p>Малина перезагрузится и изменения вступают в силу.</p>

				</p>
				<br>
				<h4><strong>
					Создаем root подключение в winscp.
				</strong></h4>
				<br>
				<p>
					Заново открываем WinSCP. Теперь используем тот же хост, но имя и  пароль root. Перед подключением имеет смысл сохранить подключение и  добавить его ярлык на рабочий стол. Если все сделали правильно - вы  зайдете в малину с root правами. Теперь вам можно все. <br><br>
					<em><strong>Для тех, кто планирует подключаться по WiFi:</strong></em> <br><br>
					По каким-то неизвестным мне причинам, WiFi иногда отваливается. Чтобы  заново не подключать клавиатуру к малине для ввода пароля, делаем вот  что. <br><br>
					Заходим в winscp с root правами. Переходим в каталог <em>boot</em>. Создаем в  нем текстовый файл <em>wifikeyfile.txt</em>
					Внутри прописываем следующее:
					<blockquote>
						ssid="RouterName"
						<footer>Имя вашей точки доступа</footer>
						psk="12345678"
						<footer>Пароль</footer>
					</blockquote>
					<p>Сохраняемся, перезагружаем малину. Теперь если вдруг что, подрубиться  к WiFi можно будет выбрав третий пункт в меню WiFi. <br><br>
					Наконец, переходим непосредственно к настройке. <br><br></p>
				</p>
				<h4><strong>
					Настройка отображения.
				</strong></h4>
				<br>
				<p>
					Вызываем из под WinSCP putty (далее терминал). Вводим: <br>
					<blockquote>
						sudo nano  /boot/config.txt
					</blockquote>
					<p>В открывшемся файле вводим разрешение вашего тв/монитора, меняем  режимы HDMI, задаем частоту процессора и прочее. Расшифровку  параметров легко найти в гугле. Если я начну описывать все эти параметры, то проще писать отдельный гайд, а оных уже и так достаточно в сети. <br>
					Так же в этом файле можно отключить отсупы по краям экрана, для этого  ищем строку:</p>
					<blockquote>
						#disable_overscan=1
					</blockquote>
					<p>и удаляем в ней <em>#</em>. <br>
					Если при запуске  малины вы не хотите видеть радужный квадрат на весь экран, то добавьте  строку </p>
					<blockquote>
						disable_splash=1
					</blockquote>
					<p>После всех изменений выходим из файла комбинацией ctrl+x и  подтверждаем изменения.</p>
					<br><br>
					<h4><strong>
						Отключаем строки кода и текста во время загрузки.
					</strong></h4>
					<br>
					<p>Если вы эстет, и вам не нравится все это безобразие во время загрузки,  то давайте его спрячем. <br><br>
					Выполняем в терминале:</p>
					<blockquote>
						sudo nano /boot/cmdline.txt
					</blockquote>
					<p>Удаляем все, что там есть, и вводим следующее <strong>одной строкой</strong> (это очень важно):</p>
					<blockquote>
						dwc_otg.lpm_enable=0 console=ttyAMA0,115200 console=tty3  root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes  rootwait quiet loglevel=3 consoleblank=0 logo.nologo plymouth.enable=0
					</blockquote>
					<p>сохраняем, перезагружаемся. <br><br>
					Если вы применили это изменение, то советую выполнить еще один  маленький квест. Штука в том, что этот трюк отлично работает, пока  малина подключена к WiFi или к пк по LAN. <br> 
					Представьте ситуацию - вы  принесли свою готовую консоль к другу ли на выставку, где уже другая точка доступа,  или вообще нет WiFi. Включаете, но после экрана заставки она вам  выдает долгую задержку, строки текста, и только потом главное меню.  Этот квест поможет отключить эту задержку. Так что ваша консоль будет  запускаться всегда быстро и без строк кода. Так, будто это законченная  и качественная вещь.
					<br><br>
					Короче, уже в самой малине открываем <em>raspi-config</em>. Выбираем <em>boot  option</em>, далее выбираем второй пункт, выбираем <em>no</em>. Все.</p>
					<br>
					<h4><strong>
						Установка заставки (Splashscreen).
					</strong></h4>
					<br>
					<p>По дефолту стоит картинка (кексик), но эту картинку можно легко  заменить, или даже установить видеозаставку. Для картинки формат  должен быть jpg или png. Для видео - mp4 в кодеке h264. Видео  скачанные с ютуба, например, проигрываются хорошо (вплоть до 1080p). <br><br>
					Насчет длительности видео - оно может быть любым. Но если вы хотите  скрыть белый экран Emulation Station, то длительность видео должна  составлять от 18 до 25 секунд (скорость загрузки не всегда  одинаковая). <br><br>
					Итак, представим, что у вас уже есть видео для заставки. Копируем его  в <em>home/pi/RetroPie/splashscreen</em> <br>
					Далее, в самой малине, переходим к настройкам и выбираем  соотвествующую опцию. Там выбираем <em>Choose splashscreen->Own  splashscreen</em>. Выбираем добавленный файл и перезагружаемся.</p>
					<br>
				</p>
				<h4><strong>
					Установка тем оформления.
				</strong></h4>
				<br>
				<p>
					В настройках выбираем <em>ES THEMES</em>, тут можно скачать готовые темы по  отдельности, либо скачать галерею (скриншоты) всех доступных тем. А-ля  предпросмотр. Если вы хотите добавить любительские или собственные  темы, то достаточно скопировать их в <em>etc/emulationstation/themes</em>. <br><br>
				</p>
				<h4><strong>
					Настройка эмуляции.
				</strong></h4>
				<br>
				<p>
					Для начала стоит определиться с тем, что мы хотим эмулировать. Затем  приготовить свой пак ромов (или скачать готовый) к выбранным системам. <br>
					Я опишу пример настройки для нескольких простых систем, с которыми  имел дело. NES SNES GB GBC GBA MEGADRIVE PSX. <br><br>
					Каждый из приведенных эмуляторов имеет общую оболочку, настройки и  принцип работы. GBA и PSX не работают без биоса. Если вы планируете  эмулировать GBA или PSX, то сейчас самое время закинуть <a target="_blank" href="ads/bios.zip">эти биосы</a> в  каталог <em>home/pi/RetroPie/bios</em> <br><br>
					Для начала следует скопировать ромы в рабочую директорию. 
					<br><br>
					<em>home/pi/RetroPie/roms</em>
					<br><br>
					В данном каталоге уже созданы папки для ромов всех систем.  Соответсвенно, ромы от NES копируем в <em>home/pi/RetroPie/roms/nes</em>, и тд.
					<br><br>
					Так же есть возможность настроить хранение ромов на внешнем накопителе  (Для меня более предпочтительный вариант). Об этом сразу и по порядку: <br><br>
					В первую очередь нужно отключить <em>usbromservice</em>. <br><br>
					В меню настроек малины выбираем <em>Retropie-Setup</em>. Далее заходим в  <em>Configurations / tools->usbromservice->disable usb rom</em>. <br><br>
					Во вторую очередь - удалить или переименовать папку <em>roms</em> из каталога <em>RetroPie</em>, там-же создать ярлык с именем <em>roms</em>, который ссылается на <em>/media/usb0/</em> (корень вашей флешки).
					<br><br>
					Далее - создать в корне флешки папки с именами систем, которые вы собираетесь эмулировать, и заливать ромы игр непосредственно в эти папки. 
					<br><br>
				</p>
				<h4><strong>
					Настройки в эмуляторах.
				</strong></h4>
				<br>
				<p>
					Как я писал ранее, все эмуляторы имеют общий принцип действия и GUI с  настройками. Следовательно, я опишу все настройки для PSX, с  остальными системами все тоже самое, и разобраться самостоятельно не  составит труда. <br><br>
					Итак, после того как мы закинули ромы и перезагрузили малину, выбираем  Playstation и запускаем любую игру. Во время запуска на секунду  появляется окно с предложением открыть настройки запуска. Его можно  легко скрыть, но пока оставим - позже обьясню зачем оно. После этого  окошка начинается непосредственно эмуляция, теперь при помощи  комбинации горячих клавиш (SELECT+X, если используете X BOX подобный  геймпад) попадаем в меню настроек. Если по каким то причинам вам не  удалось выйти в это меню с геймпада, то цепляем клавиатуру и жмем F1  (или ESC). Опишу его содержание. Не все, только более менее важные  стороны. <br><br>
					Основное меню:
					<br><br>
					<ul>
						<li>Quick menu
							<span> - быстрое меню</span>
						<ul>
							<li>Resume <span>
								 - возобновить эмуляцию
							</span></li> 
							<li>Restart <span>
								 - аппаратная перезагрузка игры
							</span></li>
							<li>Close <span>
								 - закрыть игру и вернуться в меню
							</span></li>
							<li>Take Screenshot <span>
								 - сделать скриншот
							</span></li>
							<li>State slot <span>
								 - выбор слота сохранения, всего доступно 10. <br> То есть, для  каждой игры можно создавать до 10 сохранений. 
							</span></li>
							<li>Save state <span>
								 - сохранить игру в выбранный слот
							</span></li>
							<li>Load state <span>
								 - Загрузить игру из выбранного слота
							</span></li>
							<li>Options <span>
								 - в этой опции содержатся уникальные настройки для каждого  эмулятора. <br> В основном там можно настроить региональную защиту,  особенности управления и тд. <br> В PSX из этого меню можно включить  шейдер, сглаживающий полигоны в hi-res текстуры. 
							</span></li>
							<li>Cheats <span>
								 - здесь можно вводить, активировать, сохранять и загружать  читы. Можно использовать game-genie коды. 
							</span></li>
							<li>Shaders <span>
								- настройка шейдеров, комбинирование пресетов.
								<br> Если,  например, выбрать шейдер stock и установить ему значение linear 2x, то  на выходе получим сглаживание более менее походящее на работу  оригинальной консоли. К нему можно прикрепить еще один фильтр, crt-pi,  отвечающий за полосы. Но имейте в виду, использование даже таких  простых шейдеров ощутимо съедает FPS.
							</span></li>
						</ul>
						</li>
						<li>Settings <span>
							 - основные настройки
						</span>
							<ul>
								<li>Video <span>
									 - настройка отображения. Много разных параметров, из которых  самый полезный изменение соотношения стороны.
								</span></li>
								<li>Audio <span>
									 - настройка вывода звука. Многие настройки лучше не трогать,  если не разбираетесь в этом. Единственное чем может быть полезен -  настройка громкости. 
								</span></li>
								<li>Input <span>
									 - настройки ввода. Управление + горячие клавиши. В основном все  настройки будут проходить тут, если вас не устраивает стандартное  расположение кнопок.

								</span>
									<ul>
										<li>Max Users <span>
											 - кол-во игроков.
										</span></li>
										<li>Input Hotkeys <span>
											 - настройка горячих клавиш.
										</span></li>
										<li>Input User <span>
											 - настройка управления. 
										</span></li>
									</ul>
								</li>
								<li>Onscreen Display <span>
									 - настройка отображения текста с информацией. Тот самый, который отображается при запуске игр, сохранении и загрузке сейвов.
								</span></li>
								<li>Onscreen Overlay
								<span>
									 - настройка оверлеев.
								</span>
								</li>
							</ul>
						</li>
						<li>Configurations <span>
							- тут можно и нужно сохранять конфигурацию, после  каждого измения в настройках. Иначе при следующем запуске все будет по  дефолту. 
						</span></li>
					</ul>
					<br>
					<p>И так, с настройками разобрались. Настроили каждую систему под себя,  управление, шейдеры и прочее. Сохранили все настройки в меню  Configurations и консоль вашей мечты почти готова. Осталось  разобраться с прямоугольником, который мы видим каждый раз при запуске  игры. Эта штука называется run command. Прикаждом запуске игры она  дает нам время выйти в меню преднастроек, в котором можно изменить  разрешение рендера, и главным образом - выбрать через какой эмулятор  открывать все игры или конкретную игру. Дело в том, что стоковые  эмуляторы поддерживают не 100% игр. Если вы столкнулись с тем, что при  запуске какой либо игры она тут-же вылетает, то просто выбираем в этом  меню другой эмулятор для этой игры. Все. <br><br>
					После всего этого меню run command  можно отключить, чтобы при запуске  игра стартовала сразу, без каких либо задержек. Идем в меню опций  retropie, выбираем run command, и там выбираем disabled.</p>
					<br>
				</p>
				<h4><strong>
					Обложки и метаданные.
				</strong></h4>
				<br>
				<p>
					Чтобы придать вашей библиотеке больше деталей, в меню Emulation  Station встроен скрипт, который позволяет искать в сети обложки и  описания к играм. Для этого жмем start и выбираем SCRAPER. Но  предупреждаю, что данный скрипт работает довольно медленно, а к  некоторым, вроде бы известным играм ничего не находит. Поэтому вместо  него можно использовать сторонние утилиты. Например, <a target="_blank" href="ads/Universal_XML_Scraper.zip">Universal XML Srapper</a> который работает аналогичным образом, но уже из под десктопа.  Его отличием является более гибкая настройка, возможности и скорость.  Однако он тоже имеет не полную базу. Решением в этом вопросе будет  утилита <a target="_blank" href="ads/RetropieMetadataEditor.zip">Retropie Metadata Editor</a>. В ней можно уже вручную присвоить  любое изображение и описание, а так-же редактировать другие.
					<br><br>
				</p>
				<h4><strong>
					BACKUP/Резервное копирование.
				</strong></h4>
				<br>
				<p>
					Представим, что вы все настроили настолько удачно, что настало время  создать резрвную копию, дабы заново не проходить весь этот квест.  Решений несколько. <br><br>
					1. Создание образа вашей карточки - самый простой. При помощи того-же  <em>Win 32 Diskimager</em>. Для этого втыкаем карточку в картридер ноута/компа,  запускаем утилиту, в поле <em>Device</em> выбираем букву присвоенную вашей  флешке, далее жмем на значек папки (browse), и выбираем место, куда  будем сохранять наш образ. Вводи любое имя (например - backup.img) и жмем  открыть. Теперь в окне утилиты стала активной кнопка <em>READ</em>. Жмем на нее  и ожидаем, когда все будет готово. После, этот самый образ можно  записать на флешку того-же размера, и смело пользоваться без всяких  настроек. Стоит отметить, что размер готового образа будет размером с вашу флешку, не зависимо от того, насколько она заполнена. <br><br>
					2. Ручное резервное копирование отдельных файлов. Мало ли кому это  будет полезно. Тут я просто опишу где и что хранится. 
					<br><br>
					Метаданные, обложки, настройки эмуляторов и управления хранятся тут
					<br><br>
					<em>opt/retropie/configs</em>
					<br><br>
					Просто копируете всю папку <em>configs</em>.<br><br>
					Темы оформления и настройка отображения систем (их порядок и пути к  ромам). 
					<br><br>
					<em>etc/emulationstation</em>
					<br><br>
					Из этой директории копируем все. Папку <em>themes</em> и файл <em>es_systems.cfg</em>
					<br><br>
					Так же имеет смысл сбэкапить файл <em>wifikeyfile.txt</em>, который мы  создавали в директории <em>boot</em>. А вот при бэкапе из этой директории  <em>config.txt</em> и <em>cmdline.txt</em> графическая оболочка крашится, что говорит о  том, что менять их нужно непосредственно вручную.
					<br><br>
					В каталоге <em>home/pi/RetroPie</em> можно сбэкапить папки <em>BIOS, retropiemenu</em>  (в этой папке хранятся иконки для списка настроек <em>retropie</em>, которые  можно заменять на любые другие) и <em>splashscreen</em>. 
					<br><br>
					Вот и все. Коротко, но думаю более менее ясно. 
					<br><br>
					Данная инструкция не претендует на истину, все что здесь описано - исключительно личный опыт чайника, который до этого никогда не имел дел с linux'ом и sftp клиентами. Автор не несет никакой ответственности и не исключает, что есть более простые и универсальные решения.
				</p>
			</div>
			<div class="col-sm-4">
				
			</div>
			<div id="vk_comments"></div>
				
	<br><br><br><br>
		</div>
	</div>

	

<br>
<br>
<br>
<br>

</section>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js">
</script> 
<script src="js/bootstrap.min.js">
</script>
</body>
</html>
